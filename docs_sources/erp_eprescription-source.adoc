= E-Rezept API Dokumentation zum Einlösen von E-Rezepten im EU-Ausland image:gematik_logo.png[width=150, float="right"]
include::./config-source.adoc[]
// TODO: Change
:branch: eu-examples
:date-folder: 2025-10-01-preview
:toclevels: 2

Zielgruppe: image:{FdV}[]

Hier dokumentiert die gematik die Nutzung der Schnittstellen rund um das E-Rezept aus Sicht der Versicherten für die Einlösung im EU-Ausland

toc::[]

== Zustimmung für die Nutzung von E-Rezepten im EU-Ausland

=== Zustimmung erteilen

Mit diesem Anwendungsfall kann der Versicherte seine "Einwilligung zum Einlösen im EU-Ausland" erteilen. Die Einwilligung wird unbefristet erteilt und kann jederzeit widerrufen werden.

include::../resources/openapi-adoc/e_prescription/Consent_POST.adoc[]

=== Zustimmung widerrufen

Als Versicherter möchte ich meine Zustimmung widerrufen.

==== Request
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/Consent?category=EUDISPCONS
|Method     |DELETE
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===


==== Response
[source]
----
HTTP/1.1 204 No Content
----


=== Zustimmung einsehen

Als Versicherter die erteilte Zustimmung einsehen. Im Bundle können mehrere Zustimmungen enthalten sein (aktuell EU und Patientenrechnung).

==== Request
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/Consent?category=EUDISPCONS
|Method     |GET
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===


==== Response
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/02_GET_Consent_Bundle.json[]
----

== Erstellen eines Zugriffscodes für das Einlösen im EU-Ausland

=== Erstellen des Zugriffscodes im E-Rezept-Fachdienst 

==== Request
[cols="h,a", separator=¦]
[%autowidth]
|===
¦URI        ¦https://erp.app.ti-dienste.de/$grant-eu-access-permission
¦Method     ¦POST
¦Requester ¦image:{FdV}[]
¦Responder ¦image:{eRp}[]
¦HTTP Header ¦
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

¦URL Parameter    ¦
¦Payload    ¦

[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/03_POST_AccessCode_EU_Request.json[]
----

|===

==== Response

HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/04_POST_AccessCode_EU_Response.json[]
----

=== Abfragen des Zugriffscodes im E-Rezept-Fachdienst

==== Request
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/$read-eu-access-permission
|Method     |GET
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===


==== Response
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/04_POST_AccessCode_EU_Response.json[]
----

=== Löschen des Zugriffscodes im E-Rezept-Fachdienst

==== Request
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/$revoke-eu-access-permission
|Method     |DELETE
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===

==== Response
[source]
----
HTTP/1.1 204 No Content
----

== Interaktion NCPeH mit E-Rezept-Fachdienst 

=== Abfragen von E-Rezepten des E-Rezept-Fachdienst 

Als NCPeH Deutschland möchte ich die im EU-Ausland einlösbaren E-Rezepte vom E-Rezept-Fachdienst abrufen, damit ich diese in das Ausland weiterleiten kann.

* link:https://simplifier.net/erezept-workflow/get-prescription-eu[OperationDefinition]
* link:https://simplifier.net/erezept-workflow/gem_erp_pr_par_eu_get_prescription_eu_input[Profil Input Parameter]

==== Request
[cols="h,a", separator=¦]
|===
¦URI        ¦https://erp.app.ti-dienste.de/$get-eu-prescriptions?_count
¦Method     ¦POST
¦Requester ¦image:{NCPeH}[]
¦Responder ¦image:{eRp}[]
¦HTTP Header¦

* *Authorization*: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J

¦Payload    ¦

.Beispiel für RequestType demographics
[%collapsible]
====

[source,xml]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/06_GET_Prescription_DEMOGRAPHICS.xml[]
----

====

.Beispiel für RequestType e-prescriptions-list
[%collapsible]
====

[source,xml]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/06_GET_Prescription_PRESCRIPTIONS_LIST.xml[]
----

====

.Beispiel für RequestType e-prescriptions-retrieval
[%collapsible]
====

[source,xml]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/06_GET_Prescription_PRESCRIPTIONS_RETRIEVAL.xml[]
----

====

|===


==== Response

.Beispiel für Bundle mit Verordnungen (Klicken zum Ausklappen)
[%collapsible]
====

[source,xml]
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/05_GET_Prescription_Bundle.xml[]
----

====


[cols="a,a"]
[%autowidth]
|===
s|Code   s|Type Success
|200  | OK +
[small]#Erfolgreiche Antwort mit Verschreibungsdaten, sortiert absteigend nach `MedicationRequest.authored-on`.#

s|Code   s|Type Error
|400  | Bad Request  +
[small]#Fehlerhafte Anfrage, z.B. fehlerhafter Aufbau der Anfrage.#
|401  | Unauthorized +
[small]#Ungültige Authentifizierung.#
|403  | Forbidden +
[small]#Keine Berechtigung des Clients.#
|404  | Not Found +
[small]#Keine Ergebnisse gefunden.#
|408  | Request Timeout +
[small]#Zeitüberschreitung der Anfrage.#
|429  | Too Many Requests +
[small]#Zu viele Anfragen.#
|500  | Server Errors +
[small]#Unerwarteter Serverfehler.#
|===


=== Abgabeinformationen zu einem E-Rezept einstellen

Als NCPEH Deutschland möchte ich die Abgabeinformationen zu einem E-Rezept einstellen, damit der Versicherte das die Abgabeinformationen angezeigt bekommen kann.

* link:https://simplifier.net/erezept-workflow/eucloseoperation[OperationDefinition]
* link:https://simplifier.net/erezept-workflow/gem_erp_pr_par_eu_closeoperation_input[Profil Input Parameter]

==== Request
[cols="h,a", separator=¦]
|===
¦URI        ¦https://erp.app.ti-dienste.de/Task/<id>/$eu-close
¦Method     ¦POST
¦Requester  ¦image:{NCPeH}[]
¦Responder  ¦image:{eRp}[]
¦HTTP Header¦

* *Authorization*: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J

¦Payload    ¦
[source,xml]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/07_EU_Close.xml[]
----
|===


==== Response
[source]
----
HTTP/1.1 200 OK
----

[cols="a,a"]
[%autowidth]
|===
s|Code   s|Type Success
|200  | OK +
[small]#Erfolgreiche Übermittlung der Dispensierinformationen.#

s|Code   s|Type Error
|400  | Bad Request  +
[small]#Fehlerhafte Anfrage, z.B. fehlerhafter Aufbau der Anfrage.#
|401  | Unauthorized +
[small]#Ungültige Authentifizierung.#
|403  | Forbidden +
[small]#Keine Berechtigung des Clients.#
|404  | Not Found +
[small]#Keine Ergebnisse gefunden.#
|408  | Request Timeout +
[small]#Zeitüberschreitung der Anfrage.#
|429  | Too Many Requests +
[small]#Zu viele Anfragen.#
|500  | Server Errors +
[small]#Unerwarteter Serverfehler.#
|===

