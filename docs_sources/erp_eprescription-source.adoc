= E-Rezept API Dokumentation zum Einlösen von E-Rezepten im EU-Ausland image:gematik_logo.png[width=150, float="right"]
include::./config-source.adoc[]
// TODO: Change
:branch: eu-examples
:date-folder: 2025-10-01-preview

Zielgruppe: image:{FdV}[]

Hier dokumentiert die gematik die Nutzung der Schnittstellen rund um das E-Rezept aus Sicht der Versicherten für die Einlösung im EU-Ausland

toc::[]

== Zustimmung für die Nutzung von E-Rezepten im EU-Ausland

=== Zustimmung erteilen

Mit diesem Anwendungsfall kann der Versicherte seine "Einwilligung zum Einlösen im EU-Ausland" erteilen. Die Einwilligung wird unbefristet erteilt und kann jederzeit widerrufen werden.

*Request*
[cols="h,a", separator=¦]
[%autowidth]
|===
¦URI        ¦https://erp.app.ti-dienste.de/Consent
¦Method     ¦POST
¦Requester ¦image:{FdV}[]
¦Responder ¦image:{eRp}[]
¦HTTP Header ¦
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

¦URL Parameter    ¦
¦Payload    ¦
[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/01_POST_Consent.json[]
----

|===

*Response*

HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
[source,json]
----
include::https://raw.githubusercontent.com/gematik/eRezept-Examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/01_POST_Consent_Response.json[]

----

=== Zustimmung widerrufen

Als Versicherter möchte ich meine Zustimmung widerrufen.

*Request*
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/Consent?category=EUDISPCONS
|Method     |DELETE
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===


*Response*
[source,json]
----
HTTP/1.1 204 No Content
----


=== Zustimmung einsehen

Als Versicherter die erteilte Zustimmung einsehen. Im Bundle können mehrere Zustimmungen enthalten sein (aktuell EU und Patientenrechnung).

*Request*
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/Consent?category=EUDISPCONS
|Method     |GET
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===


*Response*
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/02_GET_Consent_Bundle.json[]
----

== Erstellen eines Zugriffscodes für das Einlösen im EU-Ausland

=== Erstellen des Zugriffscodes im E-Rezept-Fachdienst 

*Request*
[cols="h,a"]
[%autowidth]
|===
|URI        |https://erp.app.ti-dienste.de/$grant-eu-access-permission
|Method     |POST
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|URL Parameter    |
|Payload    |

[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/03_POST_AccessCode_EU_Request.json[]
----

|===

*Response*

HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/04_POST_AccessCode_EU_Response.json[]
----

=== Abfragen des Zugriffscodes im E-Rezept-Fachdienst

*Request*
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/$read-eu-access-permission
|Method     |GET
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===


*Response*
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
[source,json]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/04_POST_AccessCode_EU_Response.json[]
----

=== Löschen des Zugriffscodes im E-Rezept-Fachdienst

*Request*
[cols="h,a"]
|===
|URI        |https://erp.app.ti-dienste.de/$revoke-eu-access-permission
|Method     |DELETE
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|Payload    |
|===

*Response*
[source,json]
----
HTTP/1.1 204 No Content
----

== Interkation NCPeH mit E-Rezept-Fachdienst 

=== Abfragen von E-Rezepten des E-Rezept-Fachdienst 

Als NCPeH Deutschland möchte ich die im EU-Ausland einlösbaren E-Rezepte vom E-Rezept-Fachdienst abrufen, damit ich diese in das Ausland weiterleiten kann.

*Request*
[cols="h,a", separator=¦]
|===
¦URI        ¦https://erp.app.ti-dienste.de/Prescription
¦Method     ¦GET
¦Requester ¦image:{NCPeH}[]
¦Responder ¦image:{eRp}[]
¦HTTP Header¦

* *Authorization*: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
* *X-ncpeh-requesttype*: <demographics | e-prescriptions-list | e-prescriptions-retrieval>
* *X-ncpeh-kvnr*: Der unveränderbare, 10-stellige Teil der KVNR des Versicherten.
* *X-ncpeh-zugriffscode*: Ein 6-stelliger Zugriffscode, der dem LE-EU vom Versicherten mitgeteilt wurde.
* *X-ncpeh-laendercode*: Ländercode des TLS-Zertifikats des NCPeH, 2-Byte ISO 3166-1 Alpha-2-Code.
* *X-ncpeh-practitionerName*: Vollständiger Name des HP (Human readable name).
* *X-ncpeh-practitionerRole*: Strukturelle Rolle des LE-EU in Form der deutschen Bezeichnung.
* *X-ncpeh-pointOfCare*: Name des Krankenhauses oder der medizinischen Einrichtung.
* *X-ncpeh-healthcare-facility-type*: Healthcare Facility Type gemäß eHealth DSI Code List in Form der deutschen Bezeichnung. Krankenhaus | Arztpraxis | Apotheke
* *_count*: <Anzahl der zurückzugebenden Einträge. Für `demographics` Use Case auf `1` gesetzt.>
* *id*: Die eindeutige ID der zu schließenden Task.

¦Payload    ¦

|===


*Response*

.Beispiel für Bundle mit Verordnungen (Klicken zum Ausklappen)
[%collapsible]
====

[source,xml]
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/05_GET_Prescription_Bundle.xml[]
----

====

=== Abgabeinformationen zu einem E-Rezept einstellen

Als NCPEH Deutschland möchte ich die Abgabeinformationen zu einem E-Rezept einstellen, damit der Versicherte das die Abgabeinformationen angezeigt bekommen kann.

*Request*
[cols="h,a", separator=¦]
|===
¦URI        ¦https://erp.app.ti-dienste.de/Task/<id>/$eu-close
¦Method     ¦POST
¦Requester  ¦image:{NCPeH}[]
¦Responder  ¦image:{eRp}[]
¦HTTP Header¦

* *Authorization*: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
* *X-ncpeh-kvnr*: Der unveränderbare, 10-stellige Teil der KVNR des Versicherten.
* *X-ncpeh-zugriffscode*: Ein 6-stelliger Zugriffscode, der dem LE-EU vom Versicherten mitgeteilt wurde.
* *X-ncpeh-laendercode*: Ländercode des TLS-Zertifikats des NCPeH, 2-Byte ISO 3166-1 Alpha-2-Code.
* *X-ncpeh-practitionerName*: Vollständiger Name des HP (Human readable name).
* *X-ncpeh-practitionerRole*: Strukturelle Rolle des LE-EU in Form der deutschen Bezeichnung.
* *X-ncpeh-pointOfCare*: Name des Krankenhauses oder der medizinischen Einrichtung.
* *X-ncpeh-healthcare-facility-type*: Healthcare Facility Type gemäß eHealth DSI Code List in Form der deutschen Bezeichnung. Krankenhaus | Arztpraxis | Apotheke
* *id*: Die eindeutige ID der zu schließenden Task.

¦Payload    ¦
[source,xml]
----
include::https://raw.githubusercontent.com/gematik/erezept-examples/refs/heads/feature/eu-examples/API-Examples/2025-10-01-preview/erp_eprescription/06_EU_Close.xml[]
----
|===


*Response*
[source]
----
HTTP/1.1 200 OK
----
