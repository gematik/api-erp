= E-Rezept API Dokumentation zum Einlösen von E-Rezepten im EU-Ausland image:gematik_logo.png[width=150, float="right"]
include::./config-source.adoc[]

Zielgruppe: image:{FdV}[]

Hier dokumentiert die gematik die Nutzung der Schnittstellen rund um das E-Rezept aus Sicht der Versicherten für die Einlösung im EU-Ausland

toc::[]

== Zustimmung für die Nutzung von E-Rezepten im EU-Ausland

=== Zustimmung erteilen

Mit diesem Anwendungsfall kann der Versicherte seine "Einwilligung zum Einlösen im EU-Ausland" erteilen. Die Einwilligung wird unbefristet erteilt und kann jederzeit widerrufen werden.

*Request*
[cols="h,a"]
[%autowidth]
|===
|URI        |https://erp.app.ti-dienste.de/Consent
|Method     |POST
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|URL Parameter    |
|Payload    |

[source,json]
----
include::https://raw.githubusercontent.com/gematik/fhir-profiles-erp/refs/heads/feature/workflow-1-5/Resources/fsh-generated/resources/Consent-f97a0772-c99f-4159-90c6-2a41c7d96779.json[]
----

|===

*Response*
[source,json]
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
----
include::https://raw.githubusercontent.com/gematik/fhir-profiles-erp/refs/heads/feature/workflow-1-5/Resources/fsh-generated/resources/Consent-f97a0772-c99f-4159-90c6-2a41c7d96779.json[]
----

=== Zustimmung widerrufen

Als Versicherter möchte ich meine Zustimmung widerrufen

*Request*
[cols="h,a"]
|===
|URI        |https://prescriptionserver.telematik/Consent?category=EUDISPCONS
|Method     |DELETE
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
X-AccessCode: 777bea0e13cc9c42ceec14aec3ddee2263325dc2c6c699db115f58fe423607ea
----
NOTE:  Mit dem ACCESS_TOKEN im `Authorization`-Header weist sich der Zugreifende als Versicherter aus, im Token ist seine Versichertennummer enthalten. Die Base64-Darstellung des Tokens ist stark gekürzt.

|Payload    |
|===


*Response*
[source,json]
----
HTTP/1.1 204 No Content
----


== Erstellen eines Zugriffscodes für das Einlösen im EU-Ausland

=== Erstellen des Zugriffscodes im E-Rezept-Fachdienst 

*Request*
[cols="h,a"]
[%autowidth]
|===
|URI        |https://erp.app.ti-dienste.de/$grant-eu-access-permission
|Method     |POST
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
----

|URL Parameter    |
|Payload    |
[source,json]
----
include::https://raw.githubusercontent.com/gematik/fhir-profiles-erp/refs/heads/feature/workflow-1-5/Resources/fsh-generated/resources/Parameters-Example-EU-PermissionRequest.json[]
----

|===

*Response*
[source,json]
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8
----
include::https://raw.githubusercontent.com/gematik/fhir-profiles-erp/refs/heads/feature/workflow-1-5/Resources/fsh-generated/resources/Parameters-Example-EU-PermissionResponse.json[]
----

=== Abfragen des Zugriffscodes im E-Rezept-Fachdienst

*Request*
[cols="h,a"]
|===
|URI        |https://prescriptionserver.telematik/$read-eu-access-permission
|Method     |GET
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
X-AccessCode: 777bea0e13cc9c42ceec14aec3ddee2263325dc2c6c699db115f58fe423607ea
----
NOTE: Mit dem ACCESS_TOKEN im `Authorization`-Header weist sich der Zugreifende als Versicherter aus, im Token ist seine Versichertennummer enthalten. Die Base64-Darstellung des Tokens ist stark gekürzt.

|Payload    |
|===


*Response*
[source,json]
----
HTTP/1.1 200 OK
Content-Type: application/fhir+json;charset=utf-8

include::https://raw.githubusercontent.com/gematik/fhir-profiles-erp/refs/heads/feature/workflow-1-5/Resources/fsh-generated/resources/Parameters-Example-EU-PermissionResponse.json[]
----

=== Löschen des Zugriffscodes im E-Rezept-Fachdienst

*Request*
[cols="h,a"]
|===
|URI        |https://prescriptionserver.telematik/$revoke-eu-access-permission
|Method     |DELETE
|Requester |image:{FdV}[]
|Responder |image:{eRp}[]
|HTTP Header |
----
Authorization: Bearer eyJraWQ.ewogImL2pA10Qql22ddtutrvx4FsDlz.rHQjEmB1lLmpqn9J
X-AccessCode: 777bea0e13cc9c42ceec14aec3ddee2263325dc2c6c699db115f58fe423607ea
----
NOTE:  Mit dem ACCESS_TOKEN im `Authorization`-Header weist sich der Zugreifende als Versicherter aus, im Token ist seine Versichertennummer enthalten. Die Base64-Darstellung des Tokens ist stark gekürzt.

|Payload    |
|===


*Response*
[source,json]
----
HTTP/1.1 204 No Content
----