= E-Rezept API Dokumentation zur Push Notifications
image:gematik_logo.png[width=150, float="right"]
include::./config-source.adoc[]
:toclevels: 2

Zielgruppe: image:{fdv}[] image:{eRp}[]

Das Konzept für Push Notifications wird https://gematik.github.io/gem-push-notifications-concept/index.html[hier] im Detail beschrieben. Dazu gibt es auch das https://gemspec.gematik.de/docs/gemF/gemF_PushNotification/latest/[produktübergreifende Feature-Document] mit den zugehörigen Anforderungen. 

Diese Seite erläutert ausschließlich die E-Rezept-spezifischen Details und API-Endpunkte. Die OpenAPI-Spezifikation ist link:../resources/openapi/erp_fd_push_notifications.yaml[hier] verlinkt.

toc::[]

== Setup der Push Notifications
Die E-Rezept-spezifischen API-Endpunkte für die Registrierung und Verwaltung von Pusher sind hier beschrieben.

=== Pusher Verwaltung
Dieser Endpunkt ermöglicht die Erstellung, Änderung und Löschung von Pushers für den authentifizierten Nutzer. Das Verhalten dieses Endpunkts variiert je nach Werten im JSON-Body.

Ist `kind` nicht `null`, wird der Pusher mit dieser `app_id` und `pushkey` für diesen Nutzer aktualisiert oder erstellt, falls er nicht existiert. Ist `kind` `null`, wird der Pusher mit dieser `app_id` und `pushkey` für diesen Nutzer gelöscht.

include::../resources/openapi-adoc/erp_fd_push_notifications/pushers_set_POST_Request.adoc[]
include::../resources/openapi-adoc/erp_fd_push_notifications/pushers_set_POST_Response.adoc[]

=== Liste der Pusher
Ruft alle aktuell aktiven Pusher für den authentifizierten Nutzer ab.

include::../resources/openapi-adoc/erp_fd_push_notifications/pushers_GET_Request.adoc[]
include::../resources/openapi-adoc/erp_fd_push_notifications/pushers_GET_Response.adoc[]

== Channel Verwaltung
Der E-Rezept-Fachdienst unterstützt das optionale Feature "Channels". Die spezifischen API-Endpunkte sind hier beschrieben.

=== Verfügbare Channels
Ruft alle verfügbaren Channels für den authentifizierten Nutzer ab.

include::../resources/openapi-adoc/erp_fd_push_notifications/channels_GET_Request.adoc[]
include::../resources/openapi-adoc/erp_fd_push_notifications/channels_GET_Response.adoc[]

=== Channel Konfiguration für Pusher
Ruft alle Channels und deren Konfigurationsstatus für das Gerät des authentifizierten Nutzers ab, das durch den `pushkey` identifiziert wird.

include::../resources/openapi-adoc/erp_fd_push_notifications/channels_pushkey_GET_Request.adoc[]
include::../resources/openapi-adoc/erp_fd_push_notifications/channels_pushkey_GET_Response.adoc[]

=== Channel Konfiguration Verwaltung
Dieser Endpunkt ermöglicht die Erstellung, Änderung und Löschung von Channel-Abonnements für ein bestimmtes Gerät des authentifizierten Nutzers, das durch den `pushkey` identifiziert wird. Ist ein Channel in der POST-Anfrage nicht enthalten, wird der Zustand des Channels auf dem Server nicht verändert. Ein nicht gesetzter Channel gilt als deaktiviert; entsprechend werden keine Pushes ausgelöst, die diesem Channel zugeordnet sind.

include::../resources/openapi-adoc/erp_fd_push_notifications/channels_pushkey_POST_Request.adoc[]
include::../resources/openapi-adoc/erp_fd_push_notifications/channels_pushkey_POST_Response.adoc[]

== Nachrichteninhalt
Der E-Rezept-Fachdienst verschlüsselt die Nachrichteninhalte und sendet diese im Feld Ciphertext an das Push Gateway. Die Entschlüsselung der Nachrichteninhalte erfolgt im FdV.
Die Datenstruktur der Nachrichteninhalte ist in https://gemspec.gematik.de/docs/gemSpec/gemSpec_DM_eRp/latest/[gemSpec_DM_eRp] beschrieben.

=== Beispiel Nachrichteninhalt
[source,json]
----
include::https://raw.githubusercontent.com/gematik/eRezept-Examples/{branch}/api-examples/generated-examples/erp_push_notifications/01_notification_payload.json[role=include]
----
